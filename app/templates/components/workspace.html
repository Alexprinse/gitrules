<!-- Include ActionButton Component -->
{% include 'components/ActionButton.html' %}

<div class="workspace-container" style="display: none;">
    <div class="workspace-inner">
        <!-- Context switcher and tabs container -->
        <div class="flex justify-between items-end mb-0">
            <!-- Tabs floating above container -->
            <div class="agent-tabs translate-x-1 translate-y-1">
                <button id="tab-claude" class="tab-button active px-4 py-2 bg-cyan-400 border-2 border-black border-b-0 text-black font-bold shadow-[2px_0px_0px_0px_rgba(0,0,0,1)] hover:shadow-[4px_0px_0px_0px_rgba(0,0,0,1)] hover:translate-x-[-1px] hover:translate-y-[-1px] active:shadow-[1px_0px_0px_0px_rgba(0,0,0,1)] active:translate-x-[1px] active:translate-y-[1px] transition-all text-sm relative z-10">
                    Claude code
                </button>
                <button id="tab-cursor" class="tab-button px-4 py-2 bg-gray-100 border-2 border-gray-400 border-b-0 text-gray-700 font-medium shadow-[1px_0px_0px_0px_rgba(0,0,0,0.3)] hover:shadow-[2px_0px_0px_0px_rgba(0,0,0,0.3)] hover:translate-x-[-1px] hover:translate-y-[-1px] active:shadow-[0px_0px_0px_0px_rgba(0,0,0,0.3)] active:translate-x-[1px] active:translate-y-[1px] transition-all text-sm relative z-5">
                    Cursor/others..
                </button>
            </div>
            
            <!-- Context switcher -->
            <div class="flex gap-2 items-center mb-1 mr-2">
                <label class="text-sm font-bold text-black">Context:</label>
                <select id="context-switcher" class="px-3 py-1 bg-white border-2 border-black text-black font-medium shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] focus:outline-none focus:ring-2 focus:ring-cyan-400 text-sm">
                    <!-- Options will be populated dynamically -->
                </select>
                <button id="new-context-btn" class="px-2 py-1 bg-pink-400 border-2 border-black text-black font-bold shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] hover:translate-x-[-1px] hover:translate-y-[-1px] active:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)] active:translate-x-[1px] active:translate-y-[1px] transition-all text-sm" title="New Context">
                    +
                </button>
                <button id="delete-context-btn" class="px-2 py-1 bg-red-400 border-2 border-black text-black font-bold shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] hover:translate-x-[-1px] hover:translate-y-[-1px] active:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)] active:translate-x-[1px] active:translate-y-[1px] transition-all text-sm" title="Delete Context">
                    Ã—
                </button>
            </div>
        </div>

        <!-- Editor Container -->
        <div class="bg-white border-2 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] relative z-0">
            <!-- Three-panel layout inside container -->
            <div class="workspace-grid">
                {% include 'components/workspace_files.html' %}
                {% include 'components/workspace_editor.html' %}
                {% include 'components/workspace_actions.html' %}
            </div>
        </div>
    </div>
</div>

<!-- Tab functionality -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const workspaceTabs = document.querySelectorAll('.tab-button');
    
    workspaceTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            // Remove active state from all tabs
            workspaceTabs.forEach(t => {
                t.classList.remove('active', 'bg-cyan-400', 'border-black', 'text-black', 'font-bold', 'z-10');
                t.classList.add('bg-gray-100', 'border-gray-400', 'text-gray-700', 'font-medium', 'z-5');
                t.classList.remove('shadow-[2px_0px_0px_0px_rgba(0,0,0,1)]');
                t.classList.add('shadow-[1px_0px_0px_0px_rgba(0,0,0,0.3)]');
            });
            
            // Add active state to clicked tab
            this.classList.add('active', 'bg-cyan-400', 'border-black', 'text-black', 'font-bold', 'z-10');
            this.classList.remove('bg-gray-100', 'border-gray-400', 'text-gray-700', 'font-medium', 'z-5');
            this.classList.remove('shadow-[1px_0px_0px_0px_rgba(0,0,0,0.3)]');
            this.classList.add('shadow-[2px_0px_0px_0px_rgba(0,0,0,1)]');
            
            // Update panel contents based on selected tab
            if (window.updateWorkspaceContents) {
                window.updateWorkspaceContents(this.id);
            }
        });
    });
});
</script>

<!-- Include separate JavaScript files -->
<script src="/static/js/workspace_manager.js"></script>
<script src="/static/js/file_tree.js"></script>
<script src="/static/js/monaco_editor.js"></script>
<script src="/static/js/context_manager.js"></script>

<!-- Initialize workspace -->
<script>
// Initialize workspace when page loads
document.addEventListener('DOMContentLoaded', function() {
    // Create global workspace manager instance
    const workspaceManager = new WorkspaceManager();
    window.workspaceManager = workspaceManager;
    
    // Initialize the workspace manager
    workspaceManager.init();
    
    setTimeout(() => {
        initializeWorkspaceEditor();
        initializeContextUI();
        initializeFileTree();
        
        // Initial render
        workspaceManager.render();
    }, 100);
});
</script>

<!-- Monaco Editor CDN -->
<script src="https://unpkg.com/monaco-editor@0.44.0/min/vs/loader.js"></script>