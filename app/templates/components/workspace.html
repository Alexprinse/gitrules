<!-- Include ActionButton Component -->
{% include 'components/ActionButton.html' %}

<div class="workspace-container" style="display: none;">
    <!-- Recommendations Banner -->
    <div id="recommendations-banner" class="mb-4 bg-cyan-50 border-2 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] p-4" style="display: none;">
        <div class="flex justify-between items-start">
            <div class="flex-1">
                <h3 class="text-sm font-black mb-2 flex items-center gap-2">
                    <span>âœ¨</span> AI Recommended Tools for Your Repository
                </h3>
                <div id="recommendations-content" class="text-sm">
                    <!-- Content will be populated dynamically -->
                </div>
            </div>
            <button onclick="closeRecommendationsBanner()" 
                    class="ml-4 w-6 h-6 flex items-center justify-center bg-white border-2 border-black text-black font-bold hover:bg-gray-100 transition-colors"
                    title="Close">
                Ã—
            </button>
        </div>
    </div>
    
    <div class="workspace-inner">
        <!-- Tabs container -->
        <div class="flex justify-start items-end mb-0">
            <!-- Tabs floating above container -->
            <div class="agent-tabs translate-x-1 translate-y-1">
                <button id="tab-claude" class="tab-button active px-4 py-2 bg-cyan-400 border-2 border-black border-b-0 text-black font-bold shadow-[2px_0px_0px_0px_rgba(0,0,0,1)] hover:shadow-[4px_0px_0px_0px_rgba(0,0,0,1)] hover:translate-x-[-1px] hover:translate-y-[-1px] active:shadow-[1px_0px_0px_0px_rgba(0,0,0,1)] active:translate-x-[1px] active:translate-y-[1px] transition-all text-sm relative z-10">
                    Claude code
                </button>
                <button id="tab-cursor" class="tab-button px-4 py-2 bg-gray-100 border-2 border-gray-400 border-b-0 text-gray-500 font-medium shadow-[1px_0px_0px_0px_rgba(0,0,0,0.3)] cursor-not-allowed opacity-50 text-sm relative z-5" disabled>
                    Cursor/others.. (coming soon)
                </button>
            </div>
        </div>

        <!-- Editor Container -->
        <div class="bg-white border-2 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] relative z-0" style="height: 600px;">
            <!-- Three-panel layout inside container -->
            <div class="workspace-grid" style="height: 100%;">
                {% include 'components/workspace_files.html' %}
                {% include 'components/workspace_editor.html' %}
                {% include 'components/workspace_actions.html' %}
            </div>
        </div>
    </div>
</div>

<!-- Tab functionality -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const workspaceTabs = document.querySelectorAll('.tab-button');
    
    workspaceTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            // Skip if tab is disabled
            if (this.disabled) return;
            
            // Remove active state from all tabs
            workspaceTabs.forEach(t => {
                if (!t.disabled) {
                    t.classList.remove('active', 'bg-cyan-400', 'border-black', 'text-black', 'font-bold', 'z-10');
                    t.classList.add('bg-gray-100', 'border-gray-400', 'text-gray-700', 'font-medium', 'z-5');
                    t.classList.remove('shadow-[2px_0px_0px_0px_rgba(0,0,0,1)]');
                    t.classList.add('shadow-[1px_0px_0px_0px_rgba(0,0,0,0.3)]');
                }
            });
            
            // Add active state to clicked tab
            this.classList.add('active', 'bg-cyan-400', 'border-black', 'text-black', 'font-bold', 'z-10');
            this.classList.remove('bg-gray-100', 'border-gray-400', 'text-gray-700', 'font-medium', 'z-5');
            this.classList.remove('shadow-[1px_0px_0px_0px_rgba(0,0,0,0.3)]');
            this.classList.add('shadow-[2px_0px_0px_0px_rgba(0,0,0,1)]');
            
            // Update panel contents based on selected tab
            if (window.updateWorkspaceContents) {
                window.updateWorkspaceContents(this.id);
            }
        });
    });
});
</script>

<!-- Include separate JavaScript files -->
<script src="/static/js/workspace_manager.js"></script>
<script src="/static/js/file_tree.js"></script>
<script src="/static/js/monaco_editor.js"></script>
<script src="/static/js/context_manager.js"></script>
<script src="/static/js/auto_share.js"></script>

<!-- Initialize workspace -->
<script>
// Show recommendations banner
function showRecommendationsBanner() {
    const banner = document.getElementById('recommendations-banner');
    const content = document.getElementById('recommendations-content');
    
    if (banner && content && window.currentRecommendations) {
        const reco = window.currentRecommendations;
        let html = '<div class="flex flex-wrap gap-4">';
        
        if (reco.rules && reco.rules.length > 0) {
            html += '<div><span class="font-bold">ðŸ“‹ Rules:</span> ' + reco.rules.join(', ') + '</div>';
        }
        if (reco.agents && reco.agents.length > 0) {
            html += '<div><span class="font-bold">ðŸ¤– Agents:</span> ' + reco.agents.join(', ') + '</div>';
        }
        if (reco.mcps && reco.mcps.length > 0) {
            html += '<div><span class="font-bold">ðŸ”Œ MCPs:</span> ' + reco.mcps.join(', ') + '</div>';
        }
        
        html += '</div>';
        content.innerHTML = html;
        banner.style.display = 'block';
    }
}

// Close recommendations banner
function closeRecommendationsBanner() {
    const banner = document.getElementById('recommendations-banner');
    if (banner) {
        banner.style.display = 'none';
    }
}

// Initialize workspace when page loads
document.addEventListener('DOMContentLoaded', function() {
    // Create global workspace manager instance
    const workspaceManager = new WorkspaceManager();
    window.workspaceManager = workspaceManager;
    
    // Initialize the workspace manager
    workspaceManager.init();
    
    setTimeout(() => {
        initializeWorkspaceEditor();
        initializeContextUI();
        initializeFileTree();
        
        // Initial render
        workspaceManager.render();
    }, 100);
});
</script>

<!-- Monaco Editor CDN -->
<script src="https://unpkg.com/monaco-editor@0.44.0/min/vs/loader.js"></script>