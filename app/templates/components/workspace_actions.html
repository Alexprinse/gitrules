<!-- Include ActionButton Component -->
{% include 'components/ActionButton.html' %}

<!-- Right Panel: Quick Actions -->
<div class="workspace-actions bg-pink-50 p-4">
    <h3 class="text-lg font-black text-black mb-3">Quick Actions</h3>
    
    <!-- Quick Actions Tabs -->
    <div class="flex gap-1 mb-3 border-b-2 border-black">
        <button onclick="switchQuickActionTab('mcps')" id="qa-tab-mcps" class="px-2 py-1 bg-pink-400 border-2 border-black border-b-0 relative -mb-[2px] font-bold text-xs text-black">
            MCPs
        </button>
        <button onclick="switchQuickActionTab('rules')" id="qa-tab-rules" class="px-2 py-1 bg-white border-2 border-black font-bold text-xs text-black hover:bg-gray-50">
            Rules
        </button>
        <button onclick="switchQuickActionTab('subagents')" id="qa-tab-subagents" class="px-2 py-1 bg-white border-2 border-black font-bold text-xs text-black hover:bg-gray-50">
            Subagents
        </button>
    </div>
    
    <div class="space-y-3">
        <!-- MCPs Tab Content -->
        <div id="qa-content-mcps" class="qa-tab-content">
            <div id="sidebar-mcps-container" class="space-y-2" style="margin: 4px;">
                <div class="text-xs text-gray-500">Loading...</div>
            </div>
        </div>

        <!-- Rules Tab Content -->
        <div id="qa-content-rules" class="qa-tab-content hidden">
            <div id="sidebar-rules-container" class="space-y-2" style="margin: 4px;">
                <div class="text-xs text-gray-500">Loading...</div>
            </div>
        </div>

        <!-- Subagents Tab Content -->
        <div id="qa-content-subagents" class="qa-tab-content hidden">
            <div id="sidebar-agents-container" class="space-y-2" style="margin: 4px;">
                <div class="text-xs text-gray-500">Loading...</div>
            </div>
        </div>
    </div>
</div>

<script>
function switchQuickActionTab(tabName) {
    // Hide all content
    document.querySelectorAll('.qa-tab-content').forEach(content => {
        content.classList.add('hidden');
    });
    
    // Reset all tab styles
    document.querySelectorAll('[id^="qa-tab-"]').forEach(tab => {
        tab.className = 'px-2 py-1 bg-white border-2 border-black font-bold text-xs text-black hover:bg-gray-50';
    });
    
    // Show selected content and highlight tab
    document.getElementById('qa-content-' + tabName).classList.remove('hidden');
    document.getElementById('qa-tab-' + tabName).className = 'px-2 py-1 bg-pink-400 border-2 border-black border-b-0 relative -mb-[2px] font-bold text-xs text-black';
}

// Workspace sidebar action function - just inserts text, doesn't create contexts
function insertTextAction(text) {
    if (window.insertTextAtCursor) {
        window.insertTextAtCursor(text);
    } else {
        console.error('insertTextAtCursor function not available');
    }
}

// Load sidebar actions from backend
async function loadSidebarActions() {
    try {
        const response = await fetch('/api/actions/');
        if (!response.ok) throw new Error('Failed to fetch actions');
        
        const data = await response.json();
        
        // Render MCPs
        const mcpsContainer = document.getElementById('sidebar-mcps-container');
        if (mcpsContainer && data.mcps) {
            mcpsContainer.innerHTML = data.mcps.map(mcp => `
                <button class="action-button action-button--secondary action-button--full-width" onclick="insertTextAction('${mcp.name}')">
                    <div class="action-button__plus">+</div>
                    <div class="action-button__content">
                        <span class="action-button__label">${mcp.name}</span>
                    </div>
                </button>
            `).join('');
        }
        
        // Render rules
        const rulesContainer = document.getElementById('sidebar-rules-container');
        if (rulesContainer && data.rules) {
            rulesContainer.innerHTML = data.rules.map(rule => `
                <button class="action-button action-button--accent action-button--full-width" onclick="insertTextAction('${rule.name}')">
                    <div class="action-button__plus">+</div>
                    <div class="action-button__content">
                        <span class="action-button__label">${rule.name}</span>
                    </div>
                </button>
            `).join('');
        }
        
        // Render agents
        const agentsContainer = document.getElementById('sidebar-agents-container');
        if (agentsContainer && data.agents) {
            agentsContainer.innerHTML = data.agents.map(agent => `
                <button class="action-button action-button--primary action-button--full-width" onclick="insertTextAction('${agent.name}')">
                    <div class="action-button__plus">+</div>
                    <div class="action-button__content">
                        <span class="action-button__label">${agent.name}</span>
                    </div>
                </button>
            `).join('');
        }
    } catch (error) {
        console.error('Error loading sidebar actions:', error);
    }
}

// Load actions when DOM is ready
document.addEventListener('DOMContentLoaded', function() {
    loadSidebarActions();
});
</script>